# The subchart contains default values which can be overridden here
k8sServiceChart:
  name: sms-rpc-service
  # Component is the group of services (domain) the service belongs to
  component: sms
  namespace: tp
  replicas: 12

  image:
    repository: 006764518182.dkr.ecr.ap-southeast-2.amazonaws.com/sms_rpc
    tag: ${artifact.buildNo}

  podLabels:
    # env label required for New Relic integration
    env: ${env.name}

  #podAnnotations:

  # Possible values for ServiceType are: ClusterIP | NodePort | LoadBalancer | ExternalName
  serviceType: ClusterIP
  servicePort: 10009
  serviceTargetPort: 10009
  # For Headless Services (e.g. RabbitMQ Consumers)
  # uncomment the below and ignore serviceType, servicePort and serviceTargetPort
  #serviceClusterIP: None

  # HorizontalPodAutoscaler
  hpa:
    enabled: false
    minReplicas: 2
    maxReplicas: 12
    cpuTargetAverageUtilization: 80
    memoryTargetAverageUtilization: 80

  # Pod resource limits
  resourceLimits:
    cpu: 80m
    memory: 256Mi
  resourceRequests:
    cpu: 80m
    memory: 256Mi

  # Flag to turn on/off the exposing of the contianer port and liveness and readiness probes
  # TODO: Remove this flag once all services have liveness and readiness endpoints
  exposePorts: false

  # Liveness Probe configuration
  livenessProbe:
    httpGet: true
    path: /
    initialDelaySeconds: 60
    periodSeconds: 60
    successThreshold: 1
    timeoutSeconds: 1

  # Readiness Probe configuration
  readinessProbe:
    httpGet: true
    path: /
    failureThreshold: 3
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1

  # Specify all environment variables to be added to the container.
  env:
    config:
      NR_NAME: "${env.name}"
      NR_LICENSE: "3289b893db560c39096d3c222d4a33037c24f943"
      NR_TRACING: "true"
      REDIS_URL: "redis-master.redis:6379"
      RPC_PORT: "10009"
      RABBIT_EXCHANGE: "sms"
      RABBIT_EXCHANGE_TYPE: "direct"
      WEBHOOK_RPC_HOST: "webhook-rpc-service"
      WEBHOOK_RPC_PORT: "10002"
      SENDER_RPC_HOST: "sender-rpc-service"
      SENDER_RPC_PORT: "10015"
      ACCOUNT_RPC_HOST: "account-rpc-service"
      ACCOUNT_RPC_PORT: "10001"
      TRACKLINK_DOMAIN: "track.${environmentVariable.dns}"
      OPTOUTLINK_DOMAIN: "optout.${environmentVariable.dns}"
      TRACK_LINK_RPC_HOST: "track-link-rpc-service"
      TRACK_LINK_RPC_PORT: "10010"
      OPT_OUT_RPC_HOST: "optout-rpc-service"
      OPT_OUT_RPC_PORT: "10011"
    secrets:
      RABBIT_URL: "amqp://burstsms:9ur686m6@rabbitmq.rabbitmq.svc.cluster.local:5672/sms"
